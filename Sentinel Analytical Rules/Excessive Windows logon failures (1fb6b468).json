{
    "AlertDetailOverrideAlertDescriptionFormat":  null,
    "AlertDetailOverrideAlertDisplayNameFormat":  null,
    "AlertDetailOverrideAlertSeverityColumnName":  null,
    "AlertDetailOverrideAlertTacticsColumnName":  null,
    "AlertRuleTemplateName":  "2391ce61-8c8d-41ac-9723-d945b2e90720",
    "CustomDetail":  {

                     },
    "Description":  "User has over 50 Windows logon failures today and at least 33% of the count of logon failures over the previous 7 days.",
    "DisplayName":  "Excessive Windows logon failures - [WC-AGENT]",
    "Enabled":  true,
    "EntityMapping":  [
                          {
                              "EntityType":  {

                                             },
                              "FieldMapping":  [
                                                   {
                                                       "ColumnName":  "Account",
                                                       "Identifier":  "FullName"
                                                   }
                                               ]
                          },
                          {
                              "EntityType":  {

                                             },
                              "FieldMapping":  [
                                                   {
                                                       "ColumnName":  "Computer",
                                                       "Identifier":  "FullName"
                                                   }
                                               ]
                          },
                          {
                              "EntityType":  {

                                             },
                              "FieldMapping":  [
                                                   {
                                                       "ColumnName":  "Process",
                                                       "Identifier":  "CommandLine"
                                                   }
                                               ]
                          }
                      ],
    "Etag":  "\"9c04def5-0000-1100-0000-66caed0b0000\"",
    "EventGroupingSettingAggregationKind":  {

                                            },
    "GroupingConfigurationEnabled":  true,
    "GroupingConfigurationGroupByAlertDetail":  [

                                                ],
    "GroupingConfigurationGroupByCustomDetail":  [

                                                 ],
    "GroupingConfigurationGroupByEntity":  [

                                           ],
    "GroupingConfigurationLookbackDuration":  {
                                                  "Ticks":  864000000000,
                                                  "Days":  1,
                                                  "Hours":  0,
                                                  "Milliseconds":  0,
                                                  "Minutes":  0,
                                                  "Seconds":  0,
                                                  "TotalDays":  1,
                                                  "TotalHours":  24,
                                                  "TotalMilliseconds":  86400000,
                                                  "TotalMinutes":  1440,
                                                  "TotalSeconds":  86400
                                              },
    "GroupingConfigurationMatchingMethod":  {

                                            },
    "GroupingConfigurationReopenClosedIncident":  false,
    "Id":  "/subscriptions/5cfeafdb-fc6b-4d09-971d-3320c5ec14a0/resourceGroups/training_jordan/providers/Microsoft.OperationalInsights/workspaces/acmesentinel/providers/Microsoft.SecurityInsights/alertRules/1fb6b468-4c23-4231-95f5-54864a422288",
    "IncidentConfigurationCreateIncident":  true,
    "Kind":  {

             },
    "LastModifiedUtc":  "\/Date(1724574986864)\/",
    "Name":  "1fb6b468-4c23-4231-95f5-54864a422288",
    "Query":  "let starttime = 8d;\nlet endtime = 1d;\nlet threshold = 0.333;\nlet countlimit = 50;\nSecurityEvent\n| where TimeGenerated \u003e= ago(endtime)\n| where EventID == 4625 and AccountType =~ \"User\"\n| where IpAddress !in (\"127.0.0.1\", \"::1\")\n| summarize\n    StartTime = min(TimeGenerated),\n    EndTime = max(TimeGenerated),\n    CountToday = count()\n    by\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress,\n    Process\n| join kind=leftouter (\n    SecurityEvent\n    | where TimeGenerated between (ago(starttime) .. ago(endtime))\n    | where EventID == 4625 and AccountType =~ \"User\"\n    | where IpAddress !in (\"127.0.0.1\", \"::1\")\n    | summarize CountPrev7day = count()\n        by\n        EventID,\n        Account,\n        LogonTypeName,\n        SubStatus,\n        AccountType,\n        Computer,\n        WorkstationName,\n        IpAddress\n    )\n    on\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress\n| where CountToday \u003e= coalesce(CountPrev7day, 0) * threshold and CountToday \u003e= countlimit\n//SubStatus Codes are detailed here - https://docs.microsoft.com/windows/security/threat-protection/auditing/event-4625\n| extend Reason = case(\n                      SubStatus =~ \u00270xC000005E\u0027,\n                      \u0027There are currently no logon servers available to service the logon request.\u0027,\n                      SubStatus =~ \u00270xC0000064\u0027,\n                      \u0027User logon with misspelled or bad user account\u0027,\n                      SubStatus =~ \u00270xC000006A\u0027,\n                      \u0027User logon with misspelled or bad password\u0027,\n                      SubStatus =~ \u00270xC000006D\u0027,\n                      \u0027Bad user name or password\u0027,\n                      SubStatus =~ \u00270xC000006E\u0027,\n                      \u0027Unknown user name or bad password\u0027,\n                      SubStatus =~ \u00270xC000006F\u0027,\n                      \u0027User logon outside authorized hours\u0027,\n                      SubStatus =~ \u00270xC0000070\u0027,\n                      \u0027User logon from unauthorized workstation\u0027,\n                      SubStatus =~ \u00270xC0000071\u0027,\n                      \u0027User logon with expired password\u0027,\n                      SubStatus =~ \u00270xC0000072\u0027,\n                      \u0027User logon to account disabled by administrator\u0027,\n                      SubStatus =~ \u00270xC00000DC\u0027,\n                      \u0027Indicates the Sam Server was in the wrong state to perform the desired operation\u0027,\n                      SubStatus =~ \u00270xC0000133\u0027,\n                      \u0027Clocks between DC and other computer too far out of sync\u0027,\n                      SubStatus =~ \u00270xC000015B\u0027,\n                      \u0027The user has not been granted the requested logon type (aka logon right) at this machine\u0027,\n                      SubStatus =~ \u00270xC000018C\u0027,\n                      \u0027The logon request failed because the trust relationship between the primary domain and the trusted domain failed\u0027,\n                      SubStatus =~ \u00270xC0000192\u0027,\n                      \u0027An attempt was made to logon, but the Netlogon service was not started\u0027,\n                      SubStatus =~ \u00270xC0000193\u0027,\n                      \u0027User logon with expired account\u0027,\n                      SubStatus =~ \u00270xC0000224\u0027,\n                      \u0027User is required to change password at next logon\u0027,\n                      SubStatus =~ \u00270xC0000225\u0027,\n                      \u0027Evidently a bug in Windows and not a risk\u0027,\n                      SubStatus =~ \u00270xC0000234\u0027,\n                      \u0027User logon with account locked\u0027,\n                      SubStatus =~ \u00270xC00002EE\u0027,\n                      \u0027Failure Reason: An Error occurred during Logon\u0027,\n                      SubStatus =~ \u00270xC0000413\u0027,\n                      \u0027Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine\u0027,\n                      strcat(\u0027Unknown reason substatus: \u0027, SubStatus)\n                  )\n| extend WorkstationName = iff(WorkstationName == \"-\" or isempty(WorkstationName), Computer, WorkstationName)\n| project\n    StartTime,\n    EndTime,\n    EventID,\n    Account,\n    LogonTypeName,\n    SubStatus,\n    Reason,\n    AccountType,\n    Computer,\n    WorkstationName,\n    IpAddress,\n    CountToday,\n    CountPrev7day,\n    Avg7Day = round(CountPrev7day * 1.00 / 7, 2),\n    Process\n| summarize\n    StartTime = min(StartTime),\n    EndTime = max(EndTime),\n    Computer = make_set(Computer, 128),\n    sum(CountToday),\n    sum(CountPrev7day),\n    avg(Avg7Day)\n    by\n    EventID,\n    Account,\n    IpAddress,\n    LogonTypeName,\n    SubStatus,\n    Reason,\n    AccountType,\n    WorkstationName,\n    Process\n| order by sum_CountToday desc nulls last\n| extend\n    timestamp = StartTime,\n    NTDomain = tostring(split(Account, \u0027\\\\\u0027, 0)[0]),\n    Name = tostring(split(Account, \u0027\\\\\u0027, 1)[0]),\n    HostName = tostring(split(WorkstationName, \u0027.\u0027, 0)[0]),\n    DnsDomain = tostring(strcat_array(array_slice(split(WorkstationName, \u0027.\u0027), 1, -1), \u0027.\u0027))\n| where not( ipv4_is_private( IpAddress))\n| where not( IpAddress == \"0.0.0.0\")\n| where not( IpAddress == \"127.0.0.1\")\n| where not( isempty(IpAddress ))\n| where not( IpAddress contains \"169.254\")",
    "QueryFrequency":  {
                           "Ticks":  864000000000,
                           "Days":  1,
                           "Hours":  0,
                           "Milliseconds":  0,
                           "Minutes":  0,
                           "Seconds":  0,
                           "TotalDays":  1,
                           "TotalHours":  24,
                           "TotalMilliseconds":  86400000,
                           "TotalMinutes":  1440,
                           "TotalSeconds":  86400
                       },
    "QueryPeriod":  {
                        "Ticks":  6912000000000,
                        "Days":  8,
                        "Hours":  0,
                        "Milliseconds":  0,
                        "Minutes":  0,
                        "Seconds":  0,
                        "TotalDays":  8,
                        "TotalHours":  192,
                        "TotalMilliseconds":  691200000,
                        "TotalMinutes":  11520,
                        "TotalSeconds":  691200
                    },
    "Severity":  {

                 },
    "SuppressionDuration":  {
                                "Ticks":  180000000000,
                                "Days":  0,
                                "Hours":  5,
                                "Milliseconds":  0,
                                "Minutes":  0,
                                "Seconds":  0,
                                "TotalDays":  0.20833333333333331,
                                "TotalHours":  5,
                                "TotalMilliseconds":  18000000,
                                "TotalMinutes":  300,
                                "TotalSeconds":  18000
                            },
    "SuppressionEnabled":  false,
    "SystemData":  {
                       "CreatedAt":  null,
                       "CreatedBy":  null,
                       "CreatedByType":  null,
                       "LastModifiedAt":  null,
                       "LastModifiedBy":  null,
                       "LastModifiedByType":  null
                   },
    "SystemDataCreatedAt":  null,
    "SystemDataCreatedBy":  null,
    "SystemDataCreatedByType":  null,
    "SystemDataLastModifiedAt":  null,
    "SystemDataLastModifiedBy":  null,
    "SystemDataLastModifiedByType":  null,
    "Tactic":  [
                   {

                   }
               ],
    "TemplateVersion":  "2.0.0",
    "TriggerOperator":  {

                        },
    "TriggerThreshold":  0,
    "Type":  "Microsoft.SecurityInsights/alertRules"
}