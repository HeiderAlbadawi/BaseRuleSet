{
    "contentVersion":  "1.0.0.0",
    "$schema":  "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "resources":  [
                      {
                          "id":  "[concat(resourceId(\u0027Microsoft.OperationalInsights/workspaces/providers\u0027, parameters(\u0027workspace\u0027), \u0027Microsoft.SecurityInsights\u0027),\u0027/alertRules/a2c011a6-3986-411a-9e27-286d018e1b65\u0027)]",
                          "name":  "[concat(parameters(\u0027workspace\u0027),\u0027/Microsoft.SecurityInsights/a2c011a6-3986-411a-9e27-286d018e1b65\u0027)]",
                          "type":  "Microsoft.OperationalInsights/workspaces/providers/alertRules",
                          "kind":  "Scheduled",
                          "apiVersion":  "2023-12-01-preview",
                          "properties":  {
                                             "displayName":  "Vulnerability Scanning Tool Detection [WC-DFE]",
                                             "description":  "Adversaries can scan your system with some penetration tools\n",
                                             "severity":  "Medium    ",
                                             "enabled":  true,
                                             "query":  "let alerttable = \nunion DeviceProcessEvents, DeviceFileEvents, DeviceNetworkEvents\n| where (InitiatingProcessFileName has \u0027Nessus\u0027\n    or InitiatingProcessFileName has \u0027Netsparker\u0027\n    or InitiatingProcessFileName has \u0027dirbuster\u0027\n    or InitiatingProcessFileName has \u0027hydra\u0027\n    or InitiatingProcessFileName has \u0027sqlmap\u0027\n    or InitiatingProcessFileName has \u0027sqlninja\u0027\n    or InitiatingProcessFileName has \u0027nmap\u0027\n    or InitiatingProcessFileName has \u0027zenmap\u0027\n    or InitiatingProcessFileName has \u0027netsparker\u0027\n    or InitiatingProcessFileName has \u0027burp*\u0027\n    or InitiatingProcessFileName has \u0027acunetix*\u0027\n    or InitiatingProcessFileName has \u0027rapid7\u0027\n    or InitiatingProcessFileName has \u0027nexpose\u0027\n    or InitiatingProcessFileName has \u0027openvas\u0027\n    or InitiatingProcessFileName has \u0027qualys\u0027\n    or InitiatingProcessFileName has \u0027tenable\u0027\n    or InitiatingProcessFileName has \u0027tripwire\u0027\n    or InitiatingProcessFileName has \u0027saint\u0027\n    or InitiatingProcessFileName has \u0027nikto\u0027)\n    or InitiatingProcessFileName has \u0027gfi*\u0027\n    or InitiatingProcessFileName has \u0027languard\u0027\n    or InitiatingProcessFileName has \u0027solarwind*\u0027\n    or InitiatingProcessFileName has \u0027retina\u0027\n    or InitiatingProcessFileName has \u0027aircrack*\u0027\n    or InitiatingProcessFileName has \u0027cwatch\u0027\n    or InitiatingProcessFileName has \u0027portswigger\u0027\n    or InitiatingProcessFileName has \u0027sonarqube\u0027\n    or InitiatingProcessFileName has \u0027vulcan\u0027\n    or InitiatingProcessFileName has \u0027kali\u0027\n    or InitiatingProcessFileName has \u0027commando*\u0027\n    or InitiatingProcessFileName has \u0027shredkit\u0027\n    or InitiatingProcessFileName has \u0027hashcat\u0027\n    or InitiatingProcessFileName has \u0027fiddler\u0027\n    or InitiatingProcessFileName has \u0027intruder\u0027\n    or InitiatingProcessFileName has \u0027zmap\u0027\n    or InitiatingProcessFileName has \u0027xray\u0027\n    or InitiatingProcessFileName has \u0027fuzzdb\u0027\n    or InitiatingProcessFileName has \u0027catfish\u0027\n    or InitiatingProcessFileName has \u0027coreimpact\u0027\n    or InitiatingProcessFileName has \u0027hackerone\u0027\n    or InitiatingProcessFileName has \u0027breachlock\u0027\n    or InitiatingProcessFileName has \u0027w3af\u0027\n    or InitiatingProcessFileName has \u0027johntheripper\u0027\n    or InitiatingProcessFileName has \u0027canvas\u0027\n    or InitiatingProcessFileName has \u0027nexfil\u0027\n    or InitiatingProcessFileName has \u0027osmedeus\u0027\n    or InitiatingProcessFileName has \u0027portscan\u0027\n    or InitiatingProcessFileName has \u0027*nessusd.exe*\u0027\n| where InitiatingProcessAccountName !contains \"root\"\n| project\n    TimeGenerated,\n    DeviceName,\n    FileName,\n    FolderPath,\n    InitiatingProcessAccountDomain,\n    InitiatingProcessAccountName,\n    InitiatingProcessFileName,\n    InitiatingProcessParentFileName;\nlet FilterCyberCNS =  DeviceNetworkEvents\n| where InitiatingProcessParentFileName contains \"cybercns\" or InitiatingProcessFileName contains \"cybercns\" or InitiatingProcessFileName contains \"cyberutilities\"\n| distinct DeviceName;\nalerttable\n| join kind=leftanti FilterCyberCNS on DeviceName",
                                             "queryFrequency":  "PT15M",
                                             "queryPeriod":  "PT15M",
                                             "triggerOperator":  "GreaterThan",
                                             "triggerThreshold":  0,
                                             "suppressionDuration":  "PT5H",
                                             "suppressionEnabled":  false,
                                             "startTimeUtc":  null,
                                             "tactics":  [
                                                             "Reconnaissance",
                                                             "CredentialAccess"
                                                         ],
                                             "techniques":  [

                                                            ],
                                             "subTechniques":  [

                                                               ],
                                             "alertRuleTemplateName":  null,
                                             "incidentConfiguration":  {
                                                                           "createIncident":  true,
                                                                           "groupingConfiguration":  {
                                                                                                         "enabled":  true,
                                                                                                         "reopenClosedIncident":  false,
                                                                                                         "lookbackDuration":  "PT5H",
                                                                                                         "matchingMethod":  "AllEntities",
                                                                                                         "groupByEntities":  [

                                                                                                                             ],
                                                                                                         "groupByAlertDetails":  [

                                                                                                                                 ],
                                                                                                         "groupByCustomDetails":  [

                                                                                                                                  ]
                                                                                                     }
                                                                       },
                                             "eventGroupingSettings":  {
                                                                           "aggregationKind":  "SingleAlert"
                                                                       },
                                             "alertDetailsOverride":  null,
                                             "customDetails":  null,
                                             "entityMappings":  [
                                                                    {
                                                                        "entityType":  "Account",
                                                                        "fieldMappings":  [
                                                                                              {
                                                                                                  "identifier":  "FullName",
                                                                                                  "columnName":  "InitiatingProcessAccountName"
                                                                                              },
                                                                                              {
                                                                                                  "identifier":  "DisplayName",
                                                                                                  "columnName":  "DeviceName"
                                                                                              }
                                                                                          ]
                                                                    },
                                                                    {
                                                                        "entityType":  "Process",
                                                                        "fieldMappings":  [
                                                                                              {
                                                                                                  "identifier":  "CommandLine",
                                                                                                  "columnName":  "InitiatingProcessFileName"
                                                                                              }
                                                                                          ]
                                                                    }
                                                                ],
                                             "sentinelEntitiesMappings":  null,
                                             "templateVersion":  null
                                         }
                      }
                  ],
    "parameters":  {
                       "workspace":  {
                                         "type":  "String"
                                     }
                   }
}
