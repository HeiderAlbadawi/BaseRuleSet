{
    "contentVersion":  "1.0.0.0",
    "$schema":  "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "resources":  [
                      {
                          "id":  "[concat(resourceId(\u0027Microsoft.OperationalInsights/workspaces/providers\u0027, parameters(\u0027workspace\u0027), \u0027Microsoft.SecurityInsights\u0027),\u0027/alertRules/a2c011a6-3986-411a-9e27-286d018e1b65\u0027)]",
                          "name":  "[concat(parameters(\u0027workspace\u0027),\u0027/Microsoft.SecurityInsights/a2c011a6-3986-411a-9e27-286d018e1b65\u0027)]",
                          "type":  "Microsoft.OperationalInsights/workspaces/providers/alertRules",
                          "kind":  "Scheduled",
                          "apiVersion":  "2023-12-01-preview",
                          "properties":  {
                                             "displayName":  "Vulnerability Scanning Tool Detection [WC-DFE]",
                                             "description":  "Adversaries can scan your system with some penetration tools\n",
                                             "severity":  "Low",
                                             "enabled":  true,
                                              "query": "let alerttable = \nunion DeviceProcessEvents, DeviceFileEvents, DeviceNetworkEvents\n| where (InitiatingProcessFileName has 'Nessus'\n    or InitiatingProcessFileName has 'Netsparker'\n    or InitiatingProcessFileName has 'dirbuster'\n    or InitiatingProcessFileName has 'hydra'\n    or InitiatingProcessFileName has 'sqlmap'\n    or InitiatingProcessFileName has 'sqlninja'\n    or InitiatingProcessFileName has 'nmap'\n    or InitiatingProcessFileName has 'zenmap'\n    or InitiatingProcessFileName has 'netsparker'\n    or InitiatingProcessFileName has 'burp*'\n    or InitiatingProcessFileName has 'acunetix*'\n    or InitiatingProcessFileName has 'rapid7'\n    or InitiatingProcessFileName has 'nexpose'\n    or InitiatingProcessFileName has 'openvas'\n    or InitiatingProcessFileName has 'qualys'\n    or InitiatingProcessFileName has 'tenable'\n    or InitiatingProcessFileName has 'tripwire'\n    or InitiatingProcessFileName has 'saint'\n    or InitiatingProcessFileName has 'nikto')\n    or InitiatingProcessFileName has 'gfi*'\n    or InitiatingProcessFileName has 'languard'\n    or InitiatingProcessFileName has 'solarwind*'\n    or InitiatingProcessFileName has 'retina'\n    or InitiatingProcessFileName has 'aircrack*'\n    or InitiatingProcessFileName has 'cwatch'\n    or InitiatingProcessFileName has 'portswigger'\n    or InitiatingProcessFileName has 'sonarqube'\n    or InitiatingProcessFileName has 'vulcan'\n    or InitiatingProcessFileName has 'kali'\n    or InitiatingProcessFileName has 'commando*'\n    or InitiatingProcessFileName has 'shredkit'\n    or InitiatingProcessFileName has 'hashcat'\n    or InitiatingProcessFileName has 'fiddler'\n    or InitiatingProcessFileName has 'intruder'\n    or InitiatingProcessFileName has 'zmap'\n    or InitiatingProcessFileName has 'xray'\n    or InitiatingProcessFileName has 'fuzzdb'\n    or InitiatingProcessFileName has 'catfish'\n    or InitiatingProcessFileName has 'coreimpact'\n    or InitiatingProcessFileName has 'hackerone'\n    or InitiatingProcessFileName has 'breachlock'\n    or InitiatingProcessFileName has 'w3af'\n    or InitiatingProcessFileName has 'johntheripper'\n    or InitiatingProcessFileName has 'canvas'\n    or InitiatingProcessFileName has 'nexfil'\n    or InitiatingProcessFileName has 'osmedeus'\n    or InitiatingProcessFileName has 'portscan'\n    or InitiatingProcessFileName has '*nessusd.exe*'\n| where InitiatingProcessAccountName !contains \"root\"\n| project\n    TimeGenerated,\n    DeviceName,\n    FileName,\n    FolderPath,\n    InitiatingProcessAccountDomain,\n    InitiatingProcessAccountName,\n    InitiatingProcessFileName,\n    InitiatingProcessParentFileName;\nlet FilterCyberCNS =  DeviceNetworkEvents\n| where InitiatingProcessParentFileName contains \"cybercns\" or InitiatingProcessFileName contains \"cybercns\" or InitiatingProcessFileName contains \"cyberutilities\"\n| distinct DeviceName;\nalerttable\n| join kind=leftanti FilterCyberCNS on DeviceName\n// WHITELIST START \n| extend RuleName = 'Vulnerability Scanning Tool Detection' \n| join kind=leftouter (_GetWatchlist('AnalyticalRulesEntitiesExclusions') ) on RuleName\n| extend Tuning01 = todynamic(Tuning01) \n| where not((TicketIDs contains \"2831322\" and isnotempty(Tuning01)) and InitiatingProcessFileName == Tuning01.[1] ) \n| project-away Tuning*,TicketIDs \n// WHITELIST END",
                                             "queryFrequency":  "PT15M",
                                             "queryPeriod":  "PT15M",
                                             "triggerOperator":  "GreaterThan",
                                             "triggerThreshold":  0,
                                             "suppressionDuration":  "PT5H",
                                             "suppressionEnabled":  false,
                                             "startTimeUtc":  null,
                                             "tactics":  [
                                                             "Reconnaissance",
                                                             "CredentialAccess"
                                                         ],
                                             "techniques":  [

                                                            ],
                                             "subTechniques":  [

                                                               ],
                                             "alertRuleTemplateName":  null,
                                             "incidentConfiguration":  {
                                                                           "createIncident":  true,
                                                                           "groupingConfiguration":  {
                                                                                                         "enabled":  true,
                                                                                                         "reopenClosedIncident":  false,
                                                                                                         "lookbackDuration":  "PT5H",
                                                                                                         "matchingMethod":  "AllEntities",
                                                                                                         "groupByEntities":  [

                                                                                                                             ],
                                                                                                         "groupByAlertDetails":  [

                                                                                                                                 ],
                                                                                                         "groupByCustomDetails":  [

                                                                                                                                  ]
                                                                                                     }
                                                                       },
                                             "eventGroupingSettings":  {
                                                                           "aggregationKind":  "SingleAlert"
                                                                       },
                                             "alertDetailsOverride":  null,
                                             "customDetails":  null,
                                             "entityMappings":  [
                                                                    {
                                                                        "entityType":  "Account",
                                                                        "fieldMappings":  [
                                                                                              {
                                                                                                  "identifier":  "FullName",
                                                                                                  "columnName":  "InitiatingProcessAccountName"
                                                                                              },
                                                                                              {
                                                                                                  "identifier":  "DisplayName",
                                                                                                  "columnName":  "DeviceName"
                                                                                              }
                                                                                          ]
                                                                    },
                                                                    {
                                                                        "entityType":  "Process",
                                                                        "fieldMappings":  [
                                                                                              {
                                                                                                  "identifier":  "CommandLine",
                                                                                                  "columnName":  "InitiatingProcessFileName"
                                                                                              }
                                                                                          ]
                                                                    }
                                                                ],
                                             "sentinelEntitiesMappings":  null,
                                             "templateVersion":  null
                                         }
                      }
                  ],
    "parameters":  {
                       "workspace":  {
                                         "type":  "String"
                                     }
                   }

}





